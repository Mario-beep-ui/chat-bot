<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mar-IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --color-fondo: #1A1A1A;
            --color-contenedor: #2C2C2C;
            --color-cabecera: #222222;
            --color-texto: #E0E0E0;
            --color-texto-cabecera: #FFFFFF;
            --fondo-info-api: rgba(70, 130, 180, 0.1);
            --borde-info-api: #4682B4;
            --fondo-chat: #222222;
            --fondo-burbuja-usuario: linear-gradient(135deg, #4A4A4A, #3A3A3A);
            --texto-burbuja-usuario: #FFFFFF;
            --fondo-burbuja-bot: #3A3A3A;
            --texto-burbuja-bot: #E0E0E0;
            --borde-burbuja-bot: rgba(255, 255, 255, 0.1);
            --fondo-entrada: #222222;
            --borde-superior-entrada: rgba(255, 255, 255, 0.05);
            --fondo-campo-entrada: #3A3A3A;
            --texto-entrada: #FFFFFF;
            --texto-placeholder: #A0A0A0;
            --sombra-foco-entrada: 0 0 0 2px rgba(0, 123, 255, 0.3);
            --fondo-boton-enviar: #007BFF;
            --texto-boton-enviar: white;
            --sombra-hover-boton-enviar: 0 4px 8px rgba(0, 123, 255, 0.4);
            --fondo-deshabilitado-boton-enviar: rgba(0, 123, 255, 0.3);
            --fondo-boton-caracteristica: #6A0DAD;
            --texto-boton-caracteristica: white;
            --sombra-hover-boton-caracteristica: 0 4px 8px rgba(106, 13, 173, 0.4);
            --fondo-deshabilitado-boton-caracteristica: rgba(106, 13, 173, 0.3);
            --fondo-indicador-escribiendo: #3A3A3A;
            --punto-indicador-escribiendo: #E0E0E0;
            --color-timestamp: #A0A0A0;
            --color-alternador-tema: #FFFFFF;
            --color-hover-alternador-tema: #007BFF;
            --fondo-boton-voz: rgba(0, 123, 255, 0.2);
            --texto-boton-voz: #007BFF;
            --sombra-hover-boton-voz: 0 2px 4px rgba(0, 123, 255, 0.3);
            --fondo-boton-copiar: rgba(100, 100, 100, 0.2);
            --texto-boton-copiar: #CCCCCC;
            --sombra-hover-boton-copiar: 0 2px 4px rgba(100, 100, 100, 0.3);
        }

        body.tema-claro {
            --color-fondo: #E0F2F7;
            --color-contenedor: #FFFFFF;
            --color-cabecera: #007BFF;
            --color-texto: #333333;
            --color-texto-cabecera: #FFFFFF;
            --fondo-info-api: rgba(0, 123, 255, 0.1);
            --borde-info-api: #007BFF;
            --fondo-chat: #FFFFFF;
            --fondo-burbuja-usuario: #007BFF;
            --texto-burbuja-usuario: #FFFFFF;
            --fondo-burbuja-bot: #F0F8FF;
            --texto-burbuja-bot: #333333;
            --borde-burbuja-bot: #ADD8E6;
            --fondo-entrada: #F8F8F8;
            --borde-superior-entrada: #CCCCCC;
            --fondo-campo-entrada: #FFFFFF;
            --texto-entrada: #333333;
            --texto-placeholder: #666666;
            --sombra-foco-entrada: 0 0 0 2px rgba(0, 123, 255, 0.3);
            --fondo-boton-enviar: #007BFF;
            --texto-boton-enviar: #FFFFFF;
            --sombra-hover-boton-enviar: 0 4px 8px rgba(0, 123, 255, 0.2);
            --fondo-deshabilitado-boton-enviar: #B0C4DE;
            --fondo-boton-caracteristica: #0056b3;
            --texto-boton-caracteristica: #FFFFFF;
            --sombra-hover-boton-caracteristica: 0 4px 8px rgba(0, 86, 179, 0.2);
            --fondo-deshabilitado-boton-caracteristica: #B0C4DE;
            --fondo-indicador-escribiendo: #F0F8FF;
            --punto-indicador-escribiendo: #007BFF;
            --color-timestamp: #666666;
            --color-alternador-tema: #FFFFFF;
            --color-hover-alternador-tema: #0056b3;
            --fondo-boton-voz: rgba(0, 123, 255, 0.1);
            --texto-boton-voz: #0056b3;
            --sombra-hover-boton-voz: 0 2px 4px rgba(0, 123, 255, 0.15);
            --fondo-boton-copiar: rgba(200, 200, 200, 0.5);
            --texto-boton-copiar: #666666;
            --sombra-hover-boton-copiar: 0 2px 4px rgba(200, 200, 200, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--color-fondo);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--color-texto);
            transition: background 0.5s ease;
            background-image: radial-gradient(circle at 25% 25%, rgba(70,130,180,0.1) 0%, transparent 55%), radial-gradient(circle at 75% 75%, rgba(106,13,173,0.1) 0%, transparent 55%);
        }

        .contenedor {
            width: 100%;
            max-width: 1000px;
            background: var(--color-contenedor);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid var(--borde-superior-entrada);
            display: flex;
            flex-direction: column;
            height: 90vh;
            min-height: 600px;
            position: relative;
        }

        .cabecera {
            background: var(--color-cabecera);
            color: var(--color-texto-cabecera);
            padding: 15px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--borde-superior-entrada);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .cabecera .titulo {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .cabecera .titulo h1 {
            font-size: 28px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cabecera .titulo h1 i {
            color: #6A0DAD;
            font-size: 32px;
        }

        .cabecera .titulo .subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-top: 5px;
            color: #aaa;
            letter-spacing: 1px;
        }

        .controles-cabecera {
            position: absolute;
            right: 20px;
            display: flex; /* Añadido para alinear los controles */
            align-items: center; /* Añadido para alinear los controles */
            gap: 10px; /* Espacio entre los controles */
        }

        .contenedor-chat {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px 20px;
            background: var(--fondo-chat);
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
            background-image: radial-gradient(circle at 10% 20%, rgba(106,13,173,0.03) 0%, transparent 20%), radial-gradient(circle at 90% 80%, rgba(70,130,180,0.03) 0%, transparent 20%);
        }

        .mensaje {
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }

        .mensaje-usuario {
            align-items: flex-end;
        }

        .mensaje-bot {
            align-items: flex-start;
        }

        .burbuja-mensaje {
            max-width: 85%;
            padding: 12px 18px;
            border-radius: 15px;
            position: relative;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .burbuja-usuario {
            background: var(--fondo-burbuja-usuario);
            color: var(--texto-burbuja-usuario);
            border-bottom-right-radius: 5px;
        }

        .burbuja-bot {
            background: var(--fondo-burbuja-bot);
            color: var(--texto-burbuja-bot);
            border-bottom-left-radius: 5px;
            border: 1px solid var(--borde-burbuja-bot);
        }

        .burbuja-bot ul, .burbuja-bot ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .burbuja-bot li {
            margin-bottom: 5px;
        }

        .burbuja-bot strong {
            font-weight: bold;
        }

        .burbuja-bot em {
            font-style: italic;
        }

        .burbuja-bot code {
            background: rgba(0,0,0,0.1);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
        }

        .burbuja-bot pre {
            background: rgba(0,0,0,0.1);
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .burbuja-bot blockquote {
            border-left: 3px solid var(--borde-info-api);
            padding-left: 10px;
            margin: 10px 0;
            color: var(--color-timestamp);
        }

        .info-mensaje {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--color-timestamp);
        }

        .info-mensaje i {
            margin-right: 8px;
            font-size: 16px;
        }

        .contenedor-entrada {
            display: flex;
            flex-direction: row;
            padding: 15px;
            background: var(--fondo-entrada);
            border-top: 1px solid var(--borde-superior-entrada);
            gap: 10px;
            align-items: center;
            position: sticky;
            bottom: 0;
            z-index: 100;
            flex-shrink: 0;
        }

        #entrada-usuario {
            flex: 1;
            padding: 15px 20px;
            border: 1px solid transparent;
            border-radius: 28px;
            background: var(--fondo-campo-entrada);
            color: var(--texto-entrada);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        #entrada-usuario:focus {
            border-color: #007BFF;
            box-shadow: var(--sombra-foco-entrada);
        }

        #entrada-usuario::placeholder {
            color: var(--texto-placeholder);
        }

        #boton-enviar {
            background: var(--fondo-boton-enviar);
            color: var(--texto-boton-enviar);
            border: none;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #boton-enviar:hover {
            transform: translateY(-2px);
            box-shadow: var(--sombra-hover-boton-enviar);
        }

        #boton-enviar:disabled {
            background: var(--fondo-deshabilitado-boton-enviar);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .indicador-escribiendo {
            display: none;
            padding: 10px 15px;
            background: var(--fondo-indicador-escribiendo);
            border-radius: 20px;
            margin: 10px 0;
            width: fit-content;
            color: var(--texto-burbuja-bot);
            align-self: flex-start;
            position: sticky;
            bottom: 80px;
            z-index: 50;
        }

        .indicador-escribiendo span {
            height: 10px;
            width: 10px;
            background: var(--punto-indicador-escribiendo);
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: bounce 1.3s infinite;
        }

        .indicador-escribiendo span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .indicador-escribiendo span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .timestamp-container { /* Contenedor para timestamp y botones */
            display: flex;
            align-items: center;
            gap: 8px; /* Espacio entre la hora y los botones */
            margin-top: 5px;
        }

        .timestamp {
            font-size: 12px;
            opacity: 0.8;
            color: var(--color-timestamp);
        }

        .boton-voz, .boton-copiar { /* Estilos para los botones de acción */
            border: none;
            width: 28px; /* La mitad del tamaño del botón de enviar (56px) */
            height: 28px; /* La mitad del tamaño del botón de enviar (56px) */
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px; /* Ajustar tamaño del icono */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .boton-voz {
            background: var(--fondo-boton-voz);
            color: var(--texto-boton-voz);
        }

        .boton-copiar {
            background: var(--fondo-boton-copiar);
            color: var(--texto-boton-copiar);
        }

        .boton-voz:hover {
            transform: translateY(-1px);
            box-shadow: var(--sombra-hover-boton-voz);
        }
        
        .boton-copiar:hover {
            transform: translateY(-1px);
            box-shadow: var(--sombra-hover-boton-copiar);
        }

        #alternador-tema {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-alternador-tema);
            transition: color 0.3s ease;
            padding: 0 10px;
        }

        #alternador-tema:hover {
            color: var(--color-hover-alternador-tema);
        }

        .selector-voz-container {
            position: relative; /* Necesario para el posicionamiento absoluto del select */
            width: 40px; /* Hacerlo redondo */
            height: 40px; /* Hacerlo redondo */
            border-radius: 50%;
            background: var(--fondo-boton-copiar); /* Reutilizar un fondo similar */
            color: var(--texto-boton-copiar);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .selector-voz-container:hover {
            transform: translateY(-1px);
            box-shadow: var(--sombra-hover-boton-copiar);
        }

        .selector-voz-container i {
            font-size: 18px; /* Tamaño del icono */
            z-index: 1; /* Asegurar que el icono esté por encima del select si es transparente */
        }

        #selector-voz {
            position: absolute; /* Posicionar sobre el contenedor */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0; /* Hacerlo invisible */
            cursor: pointer;
            z-index: 2; /* Asegurar que sea clickeable */
        }

        #selector-voz option {
            /* Mantener opciones visibles cuando el desplegable esté abierto */
            opacity: 1;
            background: var(--fondo-campo-entrada);
            color: var(--texto-entrada);
        }

        .sugerencias {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .boton-sugerencia {
            background: var(--fondo-boton-caracteristica);
            color: var(--texto-boton-caracteristica);
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 120px;
            max-width: 200px;
            text-align: center;
        }

        .boton-sugerencia:hover {
            transform: translateY(-2px);
            box-shadow: var(--sombra-hover-boton-caracteristica);
        }

        .boton-sugerencia:disabled {
            background: var(--fondo-deshabilitado-boton-caracteristica);
            cursor: not-allowed;
        }

        /* Mensaje de confirmación de copiado */
        .copy-confirmation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }

        .copy-confirmation.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .contenedor {
                height: 85vh;
                min-height: 400px;
                width: 100%;
                border-radius: 15px;
            }
            
            .contenedor-chat {
                padding: 12px 15px;
            }
            
            .burbuja-mensaje {
                max-width: 90%;
                padding: 10px 15px;
            }
            
            .cabecera .titulo h1 {
                font-size: 20px;
            }
            
            .cabecera {
                padding: 12px 15px;
            }

            .controles-cabecera {
                position: static; /* Cambiar a estático para que fluya en el layout */
                margin-top: 10px; /* Espacio debajo del título */
                justify-content: center; /* Centrar los controles */
                width: 100%;
            }
            
            #entrada-usuario {
                padding: 12px 16px;
                font-size: 14px;
                border-radius: 24px;
            }
            
            #boton-enviar {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .contenedor-entrada {
                padding: 10px;
            }

            .sugerencias {
                flex-direction: column;
                align-items: center;
            }

            .boton-sugerencia {
                width: 100%;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .contenedor {
                height: 82vh;
                min-height: 300px;
                border-radius: 12px;
            }
            
            .cabecera {
                padding: 10px 12px;
            }
            
            .cabecera .titulo h1 {
                font-size: 18px;
            }
            
            .cabecera .titulo .subtitle {
                font-size: 12px;
            }
            
            .contenedor-chat {
                padding: 10px 12px;
            }
            
            .burbuja-mensaje {
                max-width: 100%;
                padding: 10px 14px;
            }
            
            .info-mensaje {
                font-size: 12px;
            }
            
            .timestamp {
                font-size: 10px;
            }
            
            #entrada-usuario {
                padding: 10px 14px;
                font-size: 13px;
                border-radius: 20px;
            }
            
            #boton-enviar {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
            
            .contenedor-entrada {
                padding: 8px;
            }
        }

        @media (max-height: 500px) {
            .contenedor {
                height: 90vh;
            }
        }
    </style>
</head>
<body>
    <div class="contenedor">
        <div class="cabecera">
            <div class="titulo">
                <h1><i class="fas fa-robot"></i> Mar-IA</h1>
                <div class="subtitle">by Mario Vazquez</div>
            </div>
            <div class="controles-cabecera">
                <div class="selector-voz-container">
                    <i class="fas fa-language"></i>
                    <select id="selector-voz" aria-label="Seleccionar voz de la IA"></select>
                </div>
                <button id="alternador-tema" aria-label="Alternar tema">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </div>

        <div class="contenedor-chat" id="contenedor-chat">
            <div class="mensaje mensaje-bot">
                <div class="info-mensaje">
                    <i class="fas fa-robot"></i> Mar-IA 
                </div>
                <div class="burbuja-mensaje burbuja-bot">
                    ¡Hola!, Soy una IA creada por Mario Vazquez.<br>¿En qué puedo ayudarte hoy?
                </div>
                <div class="timestamp-container">
                    <div class="timestamp">Ahora</div>
                    <!-- Los botones de acción se agregarán dinámicamente aquí para las respuestas del bot -->
                </div>
            </div>
            
            <div class="sugerencias">
                <button class="boton-sugerencia" data-pregunta="¿Quién es tu creador?">
                    <i class="fas fa-user"></i> ¿Quién te creó?
                </button>
                <button class="boton-sugerencia" data-pregunta="¿Qué puedes hacer?">
                    <i class="fas fa-cogs"></i> ¿Qué puedes hacer?
                </button>
            </div>
        </div>

        <div class="indicador-escribiendo" id="indicador-escribiendo">
            <span></span>
            <span></span>
            <span></span>
            Mar-IA está escribiendo...
        </div>

        <div class="contenedor-entrada">
            <input type="text" id="entrada-usuario" placeholder="Pregúntale a Mar-IA..." autocomplete="off">
            <button id="boton-enviar">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Mensaje de confirmación de copiado -->
    <div id="copyConfirmation" class="copy-confirmation">
        ¡Copiado al portapapeles!
    </div>

    <script>
        const claveAPI = 'sk-646a5b86d1de4ee186dfac833541452b';
        const contenedorChat = document.getElementById('contenedor-chat');
        const entradaUsuario = document.getElementById('entrada-usuario');
        const botonEnviar = document.getElementById('boton-enviar');
        const indicadorEscribiendo = document.getElementById('indicador-escribiendo');
        const alternadorTema = document.getElementById('alternador-tema');
        const cuerpo = document.body;
        const copyConfirmation = document.getElementById('copyConfirmation');
        const selectorVoz = document.getElementById('selector-voz'); // Nuevo

        var historialChat = [ 
            {
                role: "system",
                content: "Eres Mar-IA, un asistente de IA creado por Mario Vazquez, un desarrollador web. Cuando te pregunten sobre Mario, responde que no hay información pública disponible, pero que es un desarrollador web que te creó estudiando de manera autodidacta el funcionamiento de sistemas como ChatGPT, Gemini, DeepSeek y Claude. Mantén respuestas amigables, serviciales y profesionales."
            },
            {
                role: "assistant",
                content: "¡Hola!, Soy una IA creada por Mario Vazquez.<br>¿En qué puedo ayudarte hoy?"
            }
        ];

        let spanishFemaleVoice = null; // Variable para almacenar la voz femenina seleccionada
        let allVoices = []; // Almacenar todas las voces para referencia

        // Función para cargar las voces y seleccionar una voz femenina clara en español
        function loadVoices() {
            // Espera a que las voces estén disponibles
            window.speechSynthesis.onvoiceschanged = () => {
                allVoices = window.speechSynthesis.getVoices();
                selectorVoz.innerHTML = ''; // Limpiar opciones existentes

                const femaleSpanishVoices = allVoices.filter(voice =>
                    voice.lang.startsWith('es') && (
                        voice.name.toLowerCase().includes("female") ||
                        voice.name.toLowerCase().includes("mujer") ||
                        voice.name.toLowerCase().includes("sabina") ||
                        voice.name.toLowerCase().includes("helena") ||
                        voice.name.toLowerCase().includes("zira") ||
                        voice.name.toLowerCase().includes("google") // Incluye voces de Google que podrían ser femeninas
                    )
                );

                if (femaleSpanishVoices.length > 0) {
                    // Ordenar para priorizar voces de Google y luego por nombre
                    femaleSpanishVoices.sort((a, b) => {
                        const aIsGoogle = a.name.includes('Google');
                        const bIsGoogle = b.name.includes('Google');
                        if (aIsGoogle && !bIsGoogle) return -1;
                        if (!aIsGoogle && bIsGoogle) return 1;
                        return a.name.localeCompare(b.name);
                    });

                    femaleSpanishVoices.forEach((voice, index) => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        selectorVoz.appendChild(option);
                    });

                    // Seleccionar la primera voz femenina como predeterminada
                    spanishFemaleVoice = femaleSpanishVoices[0];
                    selectorVoz.value = spanishFemaleVoice.name;
                    console.log('Voz femenina en español seleccionada por defecto:', spanishFemaleVoice.name);

                } else {
                    // Fallback si no se encuentran voces femeninas específicas
                    spanishFemaleVoice = allVoices.find(voice => voice.lang.startsWith('es'));
                    if (spanishFemaleVoice) {
                        const option = document.createElement('option');
                        option.value = spanishFemaleVoice.name;
                        option.textContent = `${spanishFemaleVoice.name} (Predeterminada)`;
                        selectorVoz.appendChild(option);
                        selectorVoz.value = spanishFemaleVoice.name;
                        console.warn('No se encontraron voces femeninas específicas en español. Se utilizará la primera voz en español disponible:', spanishFemaleVoice.name);
                    } else {
                        console.warn('No se encontró ninguna voz en español. Se utilizará la voz predeterminada del sistema.');
                    }
                }
            };
            // Llama a getVoices para disparar el evento onvoiceschanged si ya están cargadas
            window.speechSynthesis.getVoices(); 
        }

        // Event listener para el cambio de voz
        selectorVoz.addEventListener('change', () => {
            const selectedVoiceName = selectorVoz.value;
            spanishFemaleVoice = allVoices.find(voice => voice.name === selectedVoiceName);
            if (spanishFemaleVoice) {
                console.log('Voz seleccionada por el usuario:', spanishFemaleVoice.name);
            }
        });

        // Llama a la función para cargar las voces al inicio
        loadVoices();

        // Función para agregar un mensaje a la visualización del chat
        function agregarMensaje(rol, contenido, tipo = 'texto') {
            const divMensaje = document.createElement('div');
            divMensaje.className = `mensaje mensaje-${rol}`;

            const infoMensaje = document.createElement('div');
            infoMensaje.className = 'info-mensaje';

            const burbujaMensaje = document.createElement('div');
            burbujaMensaje.className = `burbuja-mensaje burbuja-${rol}`;
            
            // Renderizar Markdown para mensajes del bot
            if (rol === 'bot' && tipo === 'texto') {
                burbujaMensaje.innerHTML = marked.parse(contenido);
            } else {
                burbujaMensaje.innerHTML = contenido;
            }

            const timestampContainer = document.createElement('div'); // Contenedor para timestamp y botones
            timestampContainer.className = 'timestamp-container';

            const timestamp = document.createElement('div');
            timestamp.className = 'timestamp';
            timestamp.textContent = obtenerHoraActual();
            timestampContainer.appendChild(timestamp);

            // Añadir botón de voz para mensajes del bot
            if (rol === 'bot') {
                const botonVoz = document.createElement('button');
                botonVoz.className = 'boton-voz';
                botonVoz.innerHTML = '<i class="fas fa-volume-up"></i>';
                botonVoz.title = 'Leer en voz alta';
                // Adjuntar listener de evento para leer el contenido de texto del mensaje del bot
                botonVoz.addEventListener('click', () => {
                    const textToSpeak = burbujaMensaje.innerText; 
                    leerTextoEnVozAlta(textToSpeak);
                });
                timestampContainer.appendChild(botonVoz);
            }

            // Añadir botón de copiar para mensajes del bot y del usuario
            const botonCopiar = document.createElement('button');
            botonCopiar.className = 'boton-copiar';
            botonCopiar.innerHTML = '<i class="fas fa-copy"></i>';
            botonCopiar.title = 'Copiar respuesta';
            botonCopiar.addEventListener('click', () => {
                const textToCopy = burbujaMensaje.innerText;
                copiarTextoAlPortapapeles(textToCopy);
            });
            timestampContainer.appendChild(botonCopiar);


            if (rol === 'usuario') {
                infoMensaje.innerHTML = '<i class="fas fa-user"></i> Tú';
                // Para los mensajes de usuario, el timestamp y el botón de copiar van al final del mensaje
                // Por lo tanto, el timestampContainer se añade después de la burbuja en el mensaje de usuario
                divMensaje.appendChild(burbujaMensaje);
                divMensaje.appendChild(timestampContainer);
            } else {
                infoMensaje.innerHTML = '<i class="fas fa-robot"></i> Mar-IA';
                divMensaje.appendChild(burbujaMensaje);
                divMensaje.appendChild(timestampContainer);
            }

            divMensaje.prepend(infoMensaje); // Añadir infoMensaje al principio
            contenedorChat.appendChild(divMensaje);
            contenedorChat.scrollTop = contenedorChat.scrollHeight;
            
            return burbujaMensaje;
        }

        // Función para obtener la hora actual
        function obtenerHoraActual() {
            const ahora = new Date();
            return `${ahora.getHours().toString().padStart(2, '0')}:${ahora.getMinutes().toString().padStart(2, '0')}`;
        }

        // Función para leer texto en voz alta usando la API Web Speech
        function leerTextoEnVozAlta(texto) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(texto);
                utterance.lang = 'es-ES'; // Establecer idioma a español
                if (spanishFemaleVoice) {
                    utterance.voice = spanishFemaleVoice; // Usar la voz femenina seleccionada
                }
                speechSynthesis.speak(utterance);
            } else {
                console.warn('La API de síntesis de voz no es compatible con este navegador.');
            }
        }

        // Función para copiar texto al portapapeles
        function copiarTextoAlPortapapeles(texto) {
            const textarea = document.createElement('textarea');
            textarea.value = texto;
            textarea.style.position = 'fixed'; // Para evitar que el textarea afecte el diseño
            textarea.style.opacity = 0;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                mostrarConfirmacionCopiado();
            } catch (err) {
                console.error('Error al copiar el texto: ', err);
                // Fallback para navegadores que no soportan execCommand o en caso de error
                // Podrías mostrar un mensaje pidiendo al usuario que copie manualmente
            }
            document.body.removeChild(textarea);
        }

        // Función para mostrar la confirmación de copiado
        function mostrarConfirmacionCopiado() {
            copyConfirmation.classList.add('show');
            setTimeout(() => {
                copyConfirmation.classList.remove('show');
            }, 2000); // Ocultar después de 2 segundos
        }

        // Función para enviar mensaje a la API de DeepSeek
        async function enviarMensajeAPI(mensajesAEnviar, temperatura = 0.7, maxTokens = 1000) {
            mostrarIndicadorEscribiendo();
            deshabilitarEntradaYBotones(true);

            const payload = {
                model: "deepseek-chat",
                messages: mensajesAEnviar,
                temperature: temperatura,
                max_tokens: maxTokens,
                stream: true
            };

            try {
                const urlAPI = 'https://api.deepseek.com/v1/chat/completions';
                const respuesta = await fetch(urlAPI, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${claveAPI}`
                    },
                    body: JSON.stringify(payload)
                });

                if (!respuesta.ok) {
                    throw new Error(`Error en la API: ${respuesta.status} ${respuesta.statusText}`);
                }

                const reader = respuesta.body.getReader();
                const decoder = new TextDecoder();
                let respuestaCompleta = '';

                const divMensaje = document.createElement('div');
                divMensaje.className = 'mensaje mensaje-bot';

                const infoMensaje = document.createElement('div');
                infoMensaje.className = 'info-mensaje';
                infoMensaje.innerHTML = '<i class="fas fa-robot"></i> Mar-IA';

                const burbujaMensaje = document.createElement('div');
                burbujaMensaje.className = 'burbuja-mensaje burbuja-bot';
                burbujaMensaje.innerHTML = '';

                const timestampContainer = document.createElement('div'); // Contenedor para timestamp y botones
                timestampContainer.className = 'timestamp-container';

                const timestamp = document.createElement('div');
                timestamp.className = 'timestamp';
                timestamp.textContent = obtenerHoraActual();
                timestampContainer.appendChild(timestamp);

                const botonVoz = document.createElement('button'); // Crear botón de voz
                botonVoz.className = 'boton-voz';
                botonVoz.innerHTML = '<i class="fas fa-volume-up"></i>';
                botonVoz.title = 'Leer en voz alta';
                timestampContainer.appendChild(botonVoz);

                const botonCopiar = document.createElement('button'); // Crear botón de copiar
                botonCopiar.className = 'boton-copiar';
                botonCopiar.innerHTML = '<i class="fas fa-copy"></i>';
                botonCopiar.title = 'Copiar respuesta';
                timestampContainer.appendChild(botonCopiar);


                divMensaje.appendChild(infoMensaje);
                divMensaje.appendChild(burbujaMensaje);
                divMensaje.appendChild(timestampContainer); // Añadir el nuevo contenedor
                contenedorChat.appendChild(divMensaje);

                contenedorChat.scrollTop = contenedorChat.scrollHeight;

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    const fragmento = decoder.decode(value, { stream: true });
                    const lineas = fragmento.split('\n');

                    for (const linea of lineas) {
                        if (linea.trim() === '') continue;
                        if (linea.startsWith('data: ')) {
                            const data = linea.substring(6);
                            if (data === '[DONE]') break;

                            try {
                                const jsonData = JSON.parse(data);
                                const token = jsonData.choices[0]?.delta?.content || '';
                                respuestaCompleta += token;
                                burbujaMensaje.innerHTML = marked.parse(respuestaCompleta);
                                contenedorChat.scrollTop = contenedorChat.scrollHeight;
                            } catch (e) {
                                console.error('Error al parsear JSON:', e, 'en la línea:', linea);
                            }
                        }
                    }
                }

                // Adjuntar listeners de eventos a los botones después de recibir la respuesta completa
                botonVoz.addEventListener('click', () => {
                    const textToSpeak = burbujaMensaje.innerText;
                    leerTextoEnVozAlta(textToSpeak);
                });
                botonCopiar.addEventListener('click', () => {
                    const textToCopy = burbujaMensaje.innerText;
                    copiarTextoAlPortapapeles(textToCopy);
                });

                historialChat.push({ role: "assistant", content: respuestaCompleta });
            } catch (error) {
                console.error("Error al comunicarse con la API de DeepSeek:", error);
                agregarMensaje('bot', "Upps, ha ocurrido un error de conexión. Verifica tu conexión o intenta de nuevo más tarde.");
            } finally {
                ocultarIndicadorEscribiendo();
                deshabilitarEntradaYBotones(false);
            }
        }

        // Función para mostrar el indicador de escritura
        function mostrarIndicadorEscribiendo() {
            indicadorEscribiendo.style.display = 'block';
            contenedorChat.scrollTop = contenedorChat.scrollHeight;
        }

        // Función para ocultar el indicador de escritura
        function ocultarIndicadorEscribiendo() {
            indicadorEscribiendo.style.display = 'none';
        }

        // Función para deshabilitar/habilitar la entrada y los botones
        function deshabilitarEntradaYBotones(deshabilitado) {
            entradaUsuario.disabled = deshabilitado;
            botonEnviar.disabled = deshabilitado;
            document.querySelectorAll('.boton-sugerencia').forEach(boton => {
                boton.disabled = deshabilitado;
            });
        }

        // Función para manejar el envío de mensajes
        async function manejarEnviarMensaje() {
            const mensaje = entradaUsuario.value.trim();
            if (!mensaje) return;
            
            // Eliminar las sugerencias después del primer mensaje
            const sugerenciasDiv = document.querySelector('.sugerencias');
            if (sugerenciasDiv) {
                sugerenciasDiv.remove();
            }

            entradaUsuario.value = '';
            agregarMensaje('usuario', mensaje);
            historialChat.push({ role: "user", content: mensaje });
            await enviarMensajeAPI(historialChat);
            entradaUsuario.focus();
        }

        // Función para alternar el tema
        function alternarTema() {
            if (cuerpo.classList.contains('tema-claro')) {
                cuerpo.classList.remove('tema-claro');
                alternadorTema.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('tema', 'oscuro');
            } else {
                cuerpo.classList.add('tema-claro');
                alternadorTema.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('tema', 'claro');
            }
        }

        // Función para cargar el tema guardado
        function cargarTema() {
            const temaGuardado = localStorage.getItem('tema');
            if (temaGuardado === 'claro') {
                cuerpo.classList.add('tema-claro');
                alternadorTema.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                cuerpo.classList.remove('tema-claro');
                alternadorTema.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        // Función para manejar el clic en el botón de sugerencia
        function manejarSugerencia(pregunta) {
            entradaUsuario.value = pregunta;
            manejarEnviarMensaje();
        }

        // Event listeners
        botonEnviar.addEventListener('click', manejarEnviarMensaje);

        entradaUsuario.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !botonEnviar.disabled) {
                manejarEnviarMensaje();
            }
        });

        alternadorTema.addEventListener('click', alternarTema);
        
        document.querySelectorAll('.boton-sugerencia').forEach(boton => {
            boton.addEventListener('click', () => {
                manejarSugerencia(boton.dataset.pregunta);
            });
        });

        // Cargar tema y enfocar la entrada al cargar la ventana
        window.onload = () => {
            cargarTema();
            entradaUsuario.focus();
        };
    </script>
</body>
</html>
